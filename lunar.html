<script>
  async function convertToLunar() {
    const solarDate = document.getElementById("solarInput").value;
    if (!solarDate) {
      document.getElementById("result").innerText = "날짜를 선택하세요.";
      return;
    }

    const [y, m, d] = solarDate.split("-");

    // 인코딩된 API 키 사용
    const apiKey = "Wbkp%2FAlqvdi4rZl16gzdorIlWA89mFN6x79yc8JoTmHDkGz55az5k9VofuYNLeRz%2BWBg89%2F96R5RNrZuin0i1w%3D%3D";

    const url = `https://apis.data.go.kr/B090041/openapi/service/LrsrCldInfoService/getSolCalInfo?solYear=${y}&solMonth=${m}&solDay=${d}&ServiceKey=${apiKey}&_type=json`;

    try {
      const res = await fetch(url);
      const json = await res.json();
      const item = json.response.body.items.item;

      if (item) {
        const lunarDate = `${item.lunYear}-${item.lunMonth.toString().padStart(2, "0")}-${item.lunDay.toString().padStart(2, "0")}`;
        const leap = item.leapMonth === "1" ? " (윤달)" : "";
        document.getElementById("result").innerText = `음력: ${lunarDate}${leap}`;
      } else {
        document.getElementById("result").innerText = "변환 결과가 없습니다.";
      }
    } catch (e) {
      document.getElementById("result").innerText = "API 오류 발생";
      console.error(e); // 오류 로그 확인용
    }
  }
</script>
